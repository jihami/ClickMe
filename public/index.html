<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MAIN_PAGE</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang&family=Noto+Sans+KR&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/main.css">
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>
  <script src="http://code.jquery.com/jquery-latest.min.js"></script>
  <script src="js/main.js"></script>
  <script>
    const firebaseConfig = {
      //  firebase sdk
      apiKey: "AIzaSyAScwaKmiKUyqgxaPBk2VUrydYSHUJF3pY",
      authDomain: "clickme-ca826.firebaseapp.com",
      projectId: "clickme-ca826",
      storageBucket: "clickme-ca826.appspot.com",
      messagingSenderId: "229716770871",
      appId: "1:229716770871:web:ba982b7fd732da3dd47fb2",
      measurementId: "G-KT1SPMPS2N"
    };

    firebase.initializeApp(firebaseConfig);

    const firebaseInstance = firebase;
    const authService = firebase.auth();
    const user = firebase.auth().currentUser;

    const githubLogin = async () => {
      const provider = new firebaseInstance.auth.GithubAuthProvider();
      const data = await authService.signInWithPopup(provider);

      const username = data.additionalUserInfo.username
      console.log(username)
      const email = data.user.email
      console.log(email)
      const displayName = data.user.displayName
      console.log(displayName)
      document.getElementById('login').innerHTML = username+"님"

      // 로그인 완료 시 로그아웃 버튼 보이기
      $(function(){
        $('#logout').show();
      })

      // 세션에 name를 사용하여 저장
      sessionStorage.setItem("name", username)
    }

    function githubLogOut() {
      firebase.auth().signOut().then(() => {
        // Sign-out successful.
        document.getElementById("login").innerHTML = "Git Hub Login"
      }).catch((error) => {
        // An error happened.
        console.log("logoutError")
      });

      // 로그아웃 시 버튼 숨기기
      $(function(){
        $('#logout').hide();
      })

      // 로그아웃 시 세션 삭제
      sessionStorage.removeItem("name")
    }

    // main_title 클릭 시 menu 화면으로 스크롤
    $(function(){
      $("#main_title").click(function() {
        $('html,body').animate({scrollTop:800}, 500);
      })
    })

    // 세션이 있다면 로그인 상태 유지
    $(function (){
      if(sessionStorage.length != 0){
        document.getElementById('login').innerHTML = sessionStorage.getItem("name")+"님"

        $(function(){
          $('#logout').show();
        })
      }
    })
  </script>
</head>
<body>
  <div id="popup">
    <button type="button" id="close">
      <a href="#"><img src="img/close.PNG" alt="close"></a>
    </button>

    <div id="popup_contents">
      <button type="button" id="cancel">취소</button>
    </div>
  </div>

  <div>
    <img src="img/main_wave.png" style="width:100%; height:820px; float:left; position:absolute" alt="header">

    <div id="head">
      <div id="logo" onclick="location.href='index.html'">
        <img src="img/logo.png" alt="logo">
      </div>

      <div id="user">
        <ul id="head_menu">
          <a href="#"><li id="login" onclick="githubLogin()">Git Hub Login</li></a>
          <a href="#"><li id="logout" onclick="githubLogOut()" style="display:none;">Logout</li></a>
        </ul>
      </div>
    </div>

    <div id="main">
      <p id="main_title">ClickMe</p>

      <div id="menu">
        <ul>
          <li id="lang">
            <a href="./languages.html">
              LANG
              <img class="lang" src="https://github-readme-stats.vercel.app/api/top-langs/?username=Kimclick&layout=compact" alt="LANGUAGES"/>
            </a>
          </li>
          <li id="stayus">
            <a href="stats.html">
              STAYUS
              <img class="stat" src="https://github-readme-stats.vercel.app/api?username=anuraghazra&show_icons=true" alt="STATS"/>
            </a>
          </li>
          <li id="header">
            <a href="header.html">
              HEADER
              <img src="https://capsule-render.vercel.app/api?type=wave&color=713fe8&height=200&text=WAVE" alt="header">
            </a>
          </li>
          <li id="badge">
            <a href="badge.html">
              BADGE
              <div class="badge" id="Adobe"><img src="https://img.shields.io/badge/Badge-4A2781?style=flat-square&logo=bootstrap&logoColor=white" alt="BADGE"/></div>
            </a>
          </li>
        </ul>
      </div>
    </div>

    <div id="footer">

    </div>
  </div>
</body>
</html>
